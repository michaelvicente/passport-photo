<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Create free US passport photos online with our easy-to-use tool. No registration, no photo storage, and print at CVS, Walgreens, Target, or home. Perfect 2x2 photos every time.">
    <meta name="keywords" content="passport photo, US passport photos, digital passport photo, free passport photo, 2x2 passport photo">
    <meta name="author" content="USA DIGITAL PHOTO">
    <meta property="og:title" content="USA DIGITAL PHOTO - Free Passport Photo Maker">
    <meta property="og:description" content="Create US passport photos online for free. No photo storage. Print at CVS, Walgreens, Target, or home. Perfect 2x2 photos every time.">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://usadigitalphoto.com">
    <title>USA DIGITAL PHOTO - Free Passport Photo Maker | 2x2 Photos</title>
    <style>
        :root {
            --bg-color: #121212;
            --card-bg: #1e1e1e;
            --text-color: #e0e0e0;
            --primary-color: #4f6df5;
            --primary-hover: #3957e3;
            --secondary-color: #9b59b6;
            --secondary-hover: #8e44ad;
            --success-color: #2ecc71;
            --success-hover: #27ae60;
            --border-color: #333333;
            --secondary-text: #aaaaaa;
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
            background-color: var(--bg-color);
            color: var(--text-color);
        }
        
        h1, h2, h3, h4 {
            color: var(--text-color);
            margin-bottom: 15px;
        }
        
        h1 {
            text-align: center;
            padding: 15px 0;
            font-size: 2rem;
        }
        
        .container {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .card {
            background-color: var(--card-bg);
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
        }
        
        .guidelines {
            margin-bottom: 20px;
        }
        
        .guidelines h3 {
            margin-top: 0;
        }
        
        .guidelines ul {
            padding-left: 20px;
        }
        
        .upload-container {
            text-align: center;
            margin-bottom: 20px;
        }
        
        .btn {
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            border: none;
            color: white;
            transition: background-color 0.2s ease;
        }
        
        .btn-primary {
            background-color: var(--primary-color);
        }
        
        .btn-primary:hover {
            background-color: var(--primary-hover);
        }
        
        .btn-secondary {
            background-color: var(--secondary-color);
        }
        
        .btn-secondary:hover {
            background-color: var(--secondary-hover);
        }
        
        .btn-success {
            background-color: var(--success-color);
        }
        
        .btn-success:hover {
            background-color: var(--success-hover);
        }
        
        .editor-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-bottom: 20px;
            display: none;
        }
        
        .canvas-container {
            position: relative;
            margin-bottom: 20px;
            max-width: 100%;
            overflow: hidden;
        }
        
        #photoCanvas {
            border: 1px solid var(--border-color);
            cursor: move;
            max-width: 100%;
            height: auto;
        }
        
        #guidelineOverlay {
            position: absolute;
            top: 0;
            left: 0;
            pointer-events: none;
            max-width: 100%;
            height: auto;
        }
        
        .button-group {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 10px;
            margin-top: 20px;
        }
        
        .controls-section {
            width: 100%;
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-top: 20px;
        }
        
        .bg-controls {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
            padding: 15px;
            background-color: rgba(0, 0, 0, 0.2);
            border-radius: 5px;
            margin-top: 15px;
        }
        
        .color-picker-container {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .color-picker-wrapper {
            position: relative;
            width: 40px;
            height: 40px;
            overflow: hidden;
            border-radius: 5px;
            border: 2px solid var(--border-color);
        }
        
        input[type="color"] {
            position: absolute;
            top: -5px;
            left: -5px;
            width: 50px;
            height: 50px;
            border: none;
            cursor: pointer;
            padding: 0;
        }
        
        .current-color {
            width: 25px;
            height: 25px;
            border-radius: 50%;
            margin-left: 5px;
            border: 1px solid var(--border-color);
        }
        
        .instructions {
            margin-top: 20px;
            text-align: center;
            color: var(--secondary-text);
            font-size: 0.9rem;
        }
        
        .spinner {
            display: none;
            border: 4px solid rgba(255, 255, 255, 0.1);
            width: 25px;
            height: 25px;
            border-radius: 50%;
            border-left-color: var(--primary-color);
            animation: spin 1s linear infinite;
            margin: 0 5px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .faq-container {
            margin-top: 40px;
        }
        
        .faq-item {
            margin-bottom: 20px;
        }
        
        .faq-question {
            font-weight: bold;
            color: var(--primary-color);
            margin-bottom: 5px;
        }
        
        .faq-answer {
            color: var(--secondary-text);
        }
        
        .privacy-notice {
            text-align: center;
            padding: 15px;
            margin-top: 30px;
            border-radius: 5px;
            background-color: rgba(79, 109, 245, 0.1);
            font-weight: bold;
        }
        
        footer {
            margin-top: 40px;
            text-align: center;
            color: var(--secondary-text);
            font-size: 0.9rem;
        }
        
        /* Media queries for responsive design */
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }
            
            h1 {
                font-size: 1.8rem;
            }
            
            .canvas-container {
                width: 100%;
            }
            
            #photoCanvas, #guidelineOverlay {
                width: 100%;
                height: auto;
            }
            
            .button-group {
                flex-direction: column;
                width: 100%;
            }
            
            .btn {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <h1>USA DIGITAL PHOTO</h1>
    <h2 style="text-align: center; margin-bottom: 30px;">Create Free Passport Photos</h2>
    
    <div class="container">
        <div class="card guidelines">
            <h3>US Passport Photo Guidelines</h3>
            <ul>
                <li>2 x 2 inches (51 x 51 mm) in size</li>
                <li>Head must be between 1 inch and 1 3/8 inches (25-35 mm) from the bottom of the chin to the top of the head</li>
                <li>Taken within the last 6 months</li>
                <li>Plain white or off-white background</li>
                <li>Neutral facial expression or natural smile</li>
                <li>Both eyes open and clearly visible</li>
                <li>No glasses</li>
                <li>No head coverings (except for religious purposes)</li>
            </ul>
        </div>
        
        <div class="card">
            <div class="upload-container">
                <input type="file" id="fileInput" accept="image/*" style="display: none;">
                <button id="uploadBtn" class="btn btn-primary">Upload Photo</button>
            </div>
            
            <div class="editor-container" id="editorContainer">
                <div class="canvas-container">
                    <canvas id="photoCanvas" width="400" height="400"></canvas>
                    <canvas id="guidelineOverlay" width="400" height="400"></canvas>
                </div>
                
                <div class="controls-section">
                    <div class="bg-controls">
                        <div class="color-picker-container">
                            <span>Background Color:</span>
                            <div class="color-picker-wrapper">
                                <input type="color" id="bgColorPicker" value="#ffffff">
                            </div>
                            <div id="currentColor" class="current-color" style="background-color: #ffffff;"></div>
                        </div>
                    </div>
                </div>
                
                <div class="button-group">
                    <button id="zoomInBtn" class="btn btn-primary">Zoom In</button>
                    <button id="zoomOutBtn" class="btn btn-primary">Zoom Out</button>
                    <button id="resetBtn" class="btn btn-primary">Reset</button>
                    <button id="applyBgBtn" class="btn btn-secondary">Apply Background Color</button>
                    <button id="removeBackgroundBtn" class="btn btn-secondary">
                        <span id="loadingSpinner" class="spinner"></span>
                        Remove Background
                    </button>
                    <button id="downloadBtn" class="btn btn-success">Download 4x6 Print</button>
                </div>
                
                <div class="instructions">
                    <p>Drag the photo to center the face within the guidelines.<br>Use the zoom buttons to adjust size.</p>
                </div>
            </div>
        </div>
        
        <div class="privacy-notice">
            We will not store any images that you upload with this tool.
        </div>
        
        <div class="card faq-container">
            <h3>Frequently Asked Questions</h3>
            
            <div class="faq-item">
                <div class="faq-question">Where can I print the generated photos?</div>
                <div class="faq-answer">You can print your photos on Amazon, CVS, Walgreens or Target (ezprints).</div>
            </div>
            
            <div class="faq-item">
                <div class="faq-question">Once I have my photo, what's next?</div>
                <div class="faq-answer">Simply cut out your 2x2 photo from the 4x6. You'll have a few extra 2x2 squares that you can use as backups if you need them.</div>
            </div>
            
            <div class="faq-item">
                <div class="faq-question">Can I print my passport photos at home?</div>
                <div class="faq-answer">Yes! You can. If you have a photo printer with photo paper, you can easily print your photos instead of going to a store to print them. If you're in the market for a photo printer, check out this Canon printer from Amazon.</div>
            </div>
            
            <div class="faq-item">
                <div class="faq-question">Why do I need to use a 4x6 print?</div>
                <div class="faq-answer">Technically, you don't need to. However, this tool mathematically ensures that your passport photo dimensions are accurate. A grid of 3 photos across and 2 photos down (totaling 6 photos) validates that you have a perfect 2x2 photo to use for your passport application.</div>
            </div>
            
            <div class="faq-item">
                <div class="faq-question">How do I print my own passport photo at CVS?</div>
                <div class="faq-answer">Visit the CVS Photo website and follow the instructions for printing a single 4x6 photo.</div>
            </div>
            
            <div class="faq-item">
                <div class="faq-question">How do I print my own passport photo at Walgreens?</div>
                <div class="faq-answer">Visit the Walgreens Photo website and follow the instructions for printing a single 4x6 photo.</div>
            </div>
            
            <div class="faq-item">
                <div class="faq-question">Does USA DIGITAL PHOTO store photos?</div>
                <div class="faq-answer">Nope. Absolutely not. Never! You can use this tool and your photos are not saved. This website does not have any mechanism of keeping any photos that you upload. It's a static HTML page with no server connections other than website hosting.</div>
            </div>
        </div>
    </div>
    
    <footer>
        <p>&copy; 2025 USA DIGITAL PHOTO - Create professional passport photos for free</p>
    </footer>
    
    <!-- Schema.org structured data -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "WebApplication",
      "name": "USA DIGITAL PHOTO - Free Passport Photo Maker",
      "url": "https://usadigitalphoto.com",
      "description": "Create free US passport photos online with our easy-to-use tool. No registration, no photo storage, and print at CVS, Walgreens, Target, or home.",
      "applicationCategory": "Photography",
      "operatingSystem": "All",
      "offers": {
        "@type": "Offer",
        "price": "0",
        "priceCurrency": "USD"
      },
      "author": {
        "@type": "Organization",
        "name": "USA DIGITAL PHOTO"
      },
      "audience": {
        "@type": "Audience",
        "audienceType": "US passport applicants and travelers"
      },
      "datePublished": "2025-04-14",
      "keywords": "passport photo, US passport photos, digital passport photo, free passport photo, 2x2 passport photo",
      "potentialAction": {
        "@type": "PhotographAction",
        "object": "Passport Photo"
      },
      "review": {
        "@type": "Review",
        "reviewRating": {
          "@type": "Rating",
          "ratingValue": "4.9",
          "bestRating": "5"
        },
        "author": {
          "@type": "Person",
          "name": "Passport Photo User"
        },
        "reviewBody": "This tool helped me create perfect passport photos in minutes. Saved me money and time!"
      },
      "mainEntity": {
        "@type": "FAQPage",
        "mainEntity": [
          {
            "@type": "Question",
            "name": "Where can I print the generated photos?",
            "acceptedAnswer": {
              "@type": "Answer",
              "text": "You can print your photos on Amazon, CVS, Walgreens or Target (ezprints)."
            }
          },
          {
            "@type": "Question",
            "name": "Once I have my photo, what's next?",
            "acceptedAnswer": {
              "@type": "Answer",
              "text": "Simply cut out your 2x2 photo from the 4x6. You'll have a few extra 2x2 squares that you can use as backups if you need them."
            }
          },
          {
            "@type": "Question",
            "name": "Can I print my passport photos at home?",
            "acceptedAnswer": {
              "@type": "Answer",
              "text": "Yes! You can. If you have a photo printer with photo paper, you can easily print your photos instead of going to a store to print them."
            }
          },
          {
            "@type": "Question",
            "name": "Why do I need to use a 4x6 print?",
            "acceptedAnswer": {
              "@type": "Answer",
              "text": "Technically, you don't need to. However, this tool mathematically ensures that your passport photo dimensions are accurate. A grid of 3 photos across and 2 photos down (totaling 6 photos) validates that you have a perfect 2x2 photo to use for your passport application."
            }
          },
          {
            "@type": "Question",
            "name": "Does USA DIGITAL PHOTO store photos?",
            "acceptedAnswer": {
              "@type": "Answer",
              "text": "Nope. Absolutely not. Never! You can use this tool and your photos are not saved. This website does not have any mechanism of keeping any photos that you upload. It's a static HTML page with no server connections other than website hosting."
            }
          }
        ]
      }
    }
    </script>
    
    <script>
        // DOM elements
        const fileInput = document.getElementById('fileInput');
        const uploadBtn = document.getElementById('uploadBtn');
        const editorContainer = document.getElementById('editorContainer');
        const photoCanvas = document.getElementById('photoCanvas');
        const guidelineOverlay = document.getElementById('guidelineOverlay');
        const zoomInBtn = document.getElementById('zoomInBtn');
        const zoomOutBtn = document.getElementById('zoomOutBtn');
        const resetBtn = document.getElementById('resetBtn');
        const downloadBtn = document.getElementById('downloadBtn');
        const applyBgBtn = document.getElementById('applyBgBtn');
        const removeBackgroundBtn = document.getElementById('removeBackgroundBtn');
        const bgColorPicker = document.getElementById('bgColorPicker');
        const currentColor = document.getElementById('currentColor');
        const loadingSpinner = document.getElementById('loadingSpinner');
        
        // Canvas contexts
        const photoCtx = photoCanvas.getContext('2d');
        const guideCtx = guidelineOverlay.getContext('2d');
        
        // Variables for photo manipulation
        let originalImage = null;
        let processedImage = null;
        let scale = 1;
        let offsetX = 0;
        let offsetY = 0;
        let isDragging = false;
        let startX, startY;
        let photoWidth, photoHeight;
        let hasTransparentBg = false;
        let bgColor = "#ffffff";
        
        // Constants for US passport photo
        const PASSPORT_WIDTH_INCHES = 2;
        const PASSPORT_HEIGHT_INCHES = 2;
        const HEAD_HEIGHT_MIN_MM = 25;
        const HEAD_HEIGHT_MAX_MM = 35;
        const MM_TO_INCHES = 0.0393701;
        const PRINT_WIDTH_INCHES = 4;
        const PRINT_HEIGHT_INCHES = 6;
        const CANVAS_SIZE = 400; // Pixels for our working canvas
        
        // The average head height as a fraction of full body height
        const AVG_HEAD_RATIO = 1/8;
        
        // Event listeners - Fixed upload button issue
        uploadBtn.addEventListener('click', function() {
            fileInput.click();
        });
        
        fileInput.addEventListener('change', handleFileSelect);
        zoomInBtn.addEventListener('click', () => zoom(1.1));
        zoomOutBtn.addEventListener('click', () => zoom(0.9));
        resetBtn.addEventListener('click', resetImage);
        downloadBtn.addEventListener('click', downloadPrintablePhoto);
        applyBgBtn.addEventListener('click', applyBackgroundColor);
        removeBackgroundBtn.addEventListener('click', removeBackground);
        bgColorPicker.addEventListener('input', updateCurrentColorPreview);
        
        // Mouse events for dragging
        photoCanvas.addEventListener('mousedown', startDrag);
        photoCanvas.addEventListener('mousemove', drag);
        photoCanvas.addEventListener('mouseup', endDrag);
        photoCanvas.addEventListener('mouseleave', endDrag);
        
        // Touch events for mobile
        photoCanvas.addEventListener('touchstart', handleTouchStart, {passive: false});
        photoCanvas.addEventListener('touchmove', handleTouchMove, {passive: false});
        photoCanvas.addEventListener('touchend', endDrag);
        
        // Draw guidelines on overlay
        drawGuidelines();
        
        // Handle file selection
        function handleFileSelect(e) {
            const file = e.target.files[0];
            if (!file || !file.type.match('image.*')) return;
            
            const reader = new FileReader();
            reader.onload = function(event) {
                const img = new Image();
                img.onload = function() {
                    originalImage = img;
                    processedImage = img;
                    resetImage();
                    editorContainer.style.display = 'flex';
                    hasTransparentBg = false;
                };
                img.src = event.target.result;
            };
            reader.readAsDataURL(file);
        }
        
        // Draw guidelines for passport photo
        function drawGuidelines() {
            guideCtx.clearRect(0, 0, CANVAS_SIZE, CANVAS_SIZE);
            
            // Passport photo outline (2x2 inches)
            guideCtx.strokeStyle = 'rgba(79, 109, 245, 0.8)';
            guideCtx.lineWidth = 2;
            guideCtx.strokeRect(
                CANVAS_SIZE/2 - (CANVAS_SIZE/2), 
                CANVAS_SIZE/2 - (CANVAS_SIZE/2), 
                CANVAS_SIZE, 
                CANVAS_SIZE
            );
            
            // Head height guidelines
            const centerY = CANVAS_SIZE/2;
            const pixelsPerMM = CANVAS_SIZE / (PASSPORT_WIDTH_INCHES / MM_TO_INCHES);
            
            // Calculate minimum and maximum head heights in pixels
            const minHeadHeight = HEAD_HEIGHT_MIN_MM * pixelsPerMM;
            const maxHeadHeight = HEAD_HEIGHT_MAX_MM * pixelsPerMM;
            
            // Head position guide (oval)
            guideCtx.strokeStyle = 'rgba(155, 89, 182, 0.6)';
            guideCtx.lineWidth = 2;
            
            // Draw oval for head placement
            guideCtx.beginPath();
            guideCtx.ellipse(
                CANVAS_SIZE/2, 
                centerY - minHeadHeight/4, 
                maxHeadHeight/3, 
                maxHeadHeight/2, 
                0, 0, 2 * Math.PI
            );
            guideCtx.stroke();
            
            // Draw min and max head height lines
            guideCtx.strokeStyle = 'rgba(46, 204, 113, 0.6)';
            guideCtx.setLineDash([5, 5]);
            
            // Min head height line
            guideCtx.beginPath();
            guideCtx.moveTo(CANVAS_SIZE/4, centerY + minHeadHeight/2);
            guideCtx.lineTo(3*CANVAS_SIZE/4, centerY + minHeadHeight/2);
            guideCtx.stroke();
            
            // Max head height line
            guideCtx.beginPath();
            guideCtx.moveTo(CANVAS_SIZE/4, centerY - maxHeadHeight/2);
            guideCtx.lineTo(3*CANVAS_SIZE/4, centerY - maxHeadHeight/2);
            guideCtx.stroke();
            
            guideCtx.setLineDash([]);
            
            // Label the guidelines
            guideCtx.fillStyle = 'rgba(224, 224, 224, 0.8)';
            guideCtx.font = '12px Arial';
            guideCtx.fillText('Top of head', CANVAS_SIZE/4, centerY - maxHeadHeight/2 - 5);
            guideCtx.fillText('Bottom of chin', CANVAS_SIZE/4, centerY + minHeadHeight/2 + 15);
        }
        
        // Draw the image on canvas
        function drawImage() {
            photoCtx.clearRect(0, 0, CANVAS_SIZE, CANVAS_SIZE);
            
            if (!processedImage) return;
            
            // If background has a color applied, draw background color first
            if (hasTransparentBg) {
                photoCtx.fillStyle = bgColor;
                photoCtx.fillRect(0, 0, CANVAS_SIZE, CANVAS_SIZE);
            }
            
            photoCtx.save();
            photoCtx.translate(CANVAS_SIZE/2 + offsetX, CANVAS_SIZE/2 + offsetY);
            photoCtx.scale(scale, scale);
            photoCtx.drawImage(
                processedImage, 
                -photoWidth/2, 
                -photoHeight/2, 
                photoWidth, 
                photoHeight
            );
            photoCtx.restore();
        }
        
        // Reset image to default position and scale
        function resetImage() {
            if (!processedImage) return;
            
            // Calculate initial dimensions while maintaining aspect ratio
            if (processedImage.width > processedImage.height) {
                photoWidth = CANVAS_SIZE;
                photoHeight = (processedImage.height / processedImage.width) * CANVAS_SIZE;
            } else {
                photoHeight = CANVAS_SIZE;
                photoWidth = (processedImage.width / processedImage.height) * CANVAS_SIZE;
            }
            
            // Reset manipulation variables
            scale = 1;
            offsetX = 0;
            offsetY = 0;
            
            drawImage();
        }
        
        // Zoom in or out
        function zoom(factor) {
            scale *= factor;
            drawImage();
        }
        
        // Start dragging
        function startDrag(e) {
            if (!processedImage) return;
            
            isDragging = true;
            startX = e.clientX - photoCanvas.getBoundingClientRect().left;
            startY = e.clientY - photoCanvas.getBoundingClientRect().top;
            
            photoCanvas.style.cursor = 'grabbing';
        }
        
        // Handle touch start for mobile
        function handleTouchStart(e) {
            if (!processedImage || e.touches.length !== 1) return;
            
            e.preventDefault();
            isDragging = true;
            
            const touch = e.touches[0];
            startX = touch.clientX - photoCanvas.getBoundingClientRect().left;
            startY = touch.clientY - photoCanvas.getBoundingClientRect().top;
            
            photoCanvas.style.cursor = 'grabbing';
        }
        
        // Drag the image
        function drag(e) {
            if (!isDragging) return;
            
            const x = e.clientX - photoCanvas.getBoundingClientRect().left;
            const y = e.clientY - photoCanvas.getBoundingClientRect().top;
            
            offsetX += (x - startX);
            offsetY += (y - startY);
            
            startX = x;
            startY = y;
            
            drawImage();
        }
        
        // Handle touch move for mobile
        function handleTouchMove(e) {
            if (!isDragging || e.touches.length !== 1) return;
            
            e.preventDefault();
            
            const touch = e.touches[0];
            const x = touch.clientX - photoCanvas.getBoundingClientRect().left;
            const y = touch.clientY - photoCanvas.getBoundingClientRect().top;
            
            offsetX += (x - startX);
            offsetY += (y - startY);
            
            startX = x;
            startY = y;
            
            drawImage();
        }
        
        // End dragging
        function endDrag() {
            isDragging = false;
            photoCanvas.style.cursor = 'move';
        }
        
        // Update current color preview
        function updateCurrentColorPreview(e) {
            bgColor = e.target.value;
            currentColor.style.backgroundColor = bgColor;
            
            // If background is already transparent, update it immediately
            if (hasTransparentBg) {
                drawImage();
            }
        }
        
        // Apply selected background color without removing background
        function applyBackgroundColor() {
            if (!originalImage) return;
            
            // Create a temporary canvas for processing
            const tempCanvas = document.createElement('canvas');
            tempCanvas.width = originalImage.width;
            tempCanvas.height = originalImage.height;
            const tempCtx = tempCanvas.getContext('2d');
            
            // Draw the original image with solid background color
            tempCtx.fillStyle = bgColor;
            tempCtx.fillRect(0, 0, tempCanvas.width, tempCanvas.height);
            tempCtx.drawImage(originalImage, 0, 0);
            
            // Create a new image from the processed canvas
            const newImg = new Image();
            newImg.onload = function() {
                processedImage = newImg;
                hasTransparentBg = false;
                drawImage();
            };
            newImg.src = tempCanvas.toDataURL('image/png');
        }
        
        // Remove background from image
        function removeBackground() {
            if (!originalImage) return;
            
            // Show loading spinner
            loadingSpinner.style.display = 'inline-block';
            removeBackgroundBtn.disabled = true;
            
            // Create a temporary canvas for processing
            const tempCanvas = document.createElement('canvas');
            tempCanvas.width = originalImage.width;
            tempCanvas.height = originalImage.height;
            const tempCtx = tempCanvas.getContext('2d');
            
            // Draw the original image
            tempCtx.drawImage(originalImage, 0, 0);
            
            // Get image data
            const imageData = tempCtx.getImageData(0, 0, tempCanvas.width, tempCanvas.height);
            const data = imageData.data;
            
            // Simple background removal algorithm
            // This is a simplified version for demonstration. In a real app, you'd use more sophisticated methods.
            
            // Step 1: Find potential background color (assume corners represent background)
            const topLeft = getRGBAt(data, 0, 0, tempCanvas.width);
            const topRight = getRGBAt(data, tempCanvas.width-1, 0, tempCanvas.width);
            const bottomLeft = getRGBAt(data, 0, tempCanvas.height-1, tempCanvas.width);
            const bottomRight = getRGBAt(data, tempCanvas.width-1, tempCanvas.height-1, tempCanvas.width);
            
            // Average the corner colors to determine background
            const bgR = Math.round((topLeft.r + topRight.r + bottomLeft.r + bottomRight.r) / 4);
            const bgG = Math.round((topLeft.g + topRight.g + bottomLeft.g + bottomRight.g) / 4);
            const bgB = Math.round((topLeft.b + topRight.b + bottomLeft.b + bottomRight.b) / 4);
            
            // Step 2: Remove background by setting similar colors to transparent
            const threshold = 35; // Tolerance for color matching
            
            for (let i = 0; i < data.length; i += 4) {
                const r = data[i];
                const g = data[i + 1];
                const b = data[i + 2];
                
                // Calculate color distance
                const distance = Math.sqrt(
                    Math.pow(r - bgR, 2) + 
                    Math.pow(g - bgG, 2) + 
                    Math.pow(b - bgB, 2)
                );
                
                // If color is close to background, make it transparent
                if (distance < threshold) {
                    data[i + 3] = 0; // Alpha channel (transparent)
                }
            }
            
            // Put the processed image data back
            tempCtx.putImageData(imageData, 0, 0);
            
            // Create a new image from the processed canvas
            const newImg = new Image();
            newImg.onload = function() {
                processedImage = newImg;
                hasTransparentBg = true; // Mark as having transparent background
                drawImage();
                
                // Hide loading spinner
                loadingSpinner.style.display = 'none';
                removeBackgroundBtn.disabled = false;
            };
            newImg.src = tempCanvas.toDataURL('image/png');
            
            // Helper function to get RGB values at specific coordinates
            function getRGBAt(data, x, y, width) {
                const index = (y * width + x) * 4;
                return {
                    r: data[index],
                    g: data[index + 1],
                    b: data[index + 2]
                };
            }
        }
        
        // Generate and download printable photo sheet
        function downloadPrintablePhoto() {
            if (!processedImage) return;
            
            // Create a temporary canvas for the 4x6 print layout
            const printCanvas = document.createElement('canvas');
            
            // Set up dimensions for printing at 300 DPI
            const printDPI = 300;
            printCanvas.width = Math.round(PRINT_WIDTH_INCHES * printDPI);
            printCanvas.height = Math.round(PRINT_HEIGHT_INCHES * printDPI);
            
            const printCtx = printCanvas.getContext('2d');
            
            // Fill background
            printCtx.fillStyle = bgColor;
            printCtx.fillRect(0, 0, printCanvas.width, printCanvas.height);
            
            // Calculate passport photo size at 300 DPI
            const passportWidthPx = Math.round(PASSPORT_WIDTH_INCHES * printDPI);
            const passportHeightPx = Math.round(PASSPORT_HEIGHT_INCHES * printDPI);
            
            // Draw grid of passport photos (3x2)
            for (let row = 0; row < 2; row++) {
                for (let col = 0; col < 3; col++) {
                    const x = col * passportWidthPx;
                    const y = row * passportHeightPx;
                    
                    // Create a temporary canvas for each passport photo
                    const passportCanvas = document.createElement('canvas');
                    passportCanvas.width = passportWidthPx;
                    passportCanvas.height = passportHeightPx;
                    const passportCtx = passportCanvas.getContext('2d');
                    
                    // Fill background for each passport photo
                    passportCtx.fillStyle = bgColor;
                    passportCtx.fillRect(0, 0, passportWidthPx, passportHeightPx);
                    
                    // Calculate scaling and positioning to match what's shown in the editor
                    const scaleFactor = passportWidthPx / CANVAS_SIZE;
                    
                    passportCtx.save();
                    passportCtx.translate(passportWidthPx/2 + offsetX * scaleFactor, passportHeightPx/2 + offsetY * scaleFactor);
                    passportCtx.scale(scale * scaleFactor, scale * scaleFactor);
                    
                    // Draw the image centered
                    const displayWidth = photoWidth;
                    const displayHeight = photoHeight;
                    
                    passportCtx.drawImage(
                        processedImage, 
                        -displayWidth/2, 
                        -displayHeight/2, 
                        displayWidth, 
                        displayHeight
                    );
                    passportCtx.restore();
                    
                    // Draw border around each passport photo
                    passportCtx.strokeStyle = 'rgba(0,0,0,0.2)';
                    passportCtx.lineWidth = 1;
                    passportCtx.strokeRect(0, 0, passportWidthPx, passportHeightPx);
                    
                    // Add the passport photo to the print sheet
                    printCtx.drawImage(passportCanvas, x, y);
                }
            }
            
            // Create download link
            const link = document.createElement('a');
            link.download = 'passport_photos.png';
            link.href = printCanvas.toDataURL('image/png');
            link.click();
        }
        </script>
</body>
</html>